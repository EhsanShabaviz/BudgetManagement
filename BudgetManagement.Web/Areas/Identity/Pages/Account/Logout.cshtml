@page
@attribute [Authorize]

@using BudgetManagement.Application.Interfaces
@using BudgetManagement.Infrastructure.Identity
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity
@using System.Security.Claims

@inject SignInManager<ApplicationUser> signInManager
@inject IAuditLogger auditLogger

@{
    Layout = null;
}

@functions
{

    public async Task<IActionResult> OnGet()
    {
        var userId = User.FindFirstValue(ClaimTypes.NameIdentifier) ?? "";
        var userName = User.Identity?.Name ?? "Unknown";

        if (signInManager.IsSignedIn(User))
        {
            await signInManager.SignOutAsync();
            await auditLogger.LogAsync(userId, userName, "Logout");
        }

        return Redirect("~/");
    }
}